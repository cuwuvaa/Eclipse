{% extends "main/base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/room.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}
<div id="blur-wrapper">
<div class="room-container">
  <div class="main-room-content">
    <div class="room-header">
        <img src="{{ room.avatar.url }}" alt="{{ room.name }} avatar" class="room-page-avatar">
        <div class="room-header-info">
            <h1 class="room-page-title">{{ room.name }}</h1>
            <p class="room-page-description">{{ room.description }}</p>
        </div>
    </div>
    <div class="chat-section">
      <h2 class="section-title">Chat</h2>
      <div id="messages">
        <div id="topMarker"></div>
      </div>
      <div class="message-input-area">
        <input id="message_input" placeholder="Type a message...">
        <button id="message_send">Send</button>
      </div>
    </div>
    <div class="room-members-section">
      <div class="section-header">
        <h2 class="section-title">Room Members</h2>
        <button id="room-settings-btn" class="btn btn-secondary" style="display: none;"><i class="fas fa-cog"></i></button>
      </div>
      <div id="room_members"></div>
    </div>
  </div>

  <div id="room-settings-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Room Settings</h2>
        <form id="room-settings-form">
            <label for="room-description">Description</label>
            <textarea id="room-description" name="description"></textarea>
            <label for="room-avatar">Avatar</label>
            <input type="file" id="room-avatar" name="avatar" accept="image/*">
            <button type="submit" class="submit-btn">Save</button>
        </form>
        <button id="delete-room-btn" class="btn btn-danger" style="display: none;">Delete Room</button>
    </div>
  </div>

  <div id="delete-room-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Delete Room</h2>
        <p>To delete this room, please enter the following passphrase: <strong>delete {{ room.name }}</strong></p>
        <form id="delete-room-form">
            <input type="text" id="passphrase-input" placeholder="Enter passphrase...">
            <button type="submit" id="confirm-delete-btn" class="submit-btn btn-danger">Delete</button>
        </form>
    </div>
  </div>

  <div class="sidebar">
    <div class="voice-call-section">
      <h2 class="section-title">Voice Call</h2>
      <div class="media-controls">
        <button id="connect_call" class="btn btn-success"><i class="fas fa-phone"></i></button>
        <button id="disconnect_call" class="btn btn-danger" style="display: none;"><i class="fas fa-phone-slash"></i></button>
        <button id="toggle_mic" class="btn btn-secondary" style="display: none;"><i class="fas fa-microphone"></i></button>
        <button id="toggle_cam" class="btn btn-secondary" style="display: none;"><i class="fas fa-video"></i></button>
        <button id="toggle_demo" class="btn btn-secondary" style="display: none;"><i class="fas fa-desktop"></i></button>
      </div>
      <div id="local-video-container"></div>
      <div id="voice_participants"></div>
      <div id="remote-media-container"></div>
    </div>
  </div>
</div>
</div>

<script src="{% static 'js/config.js' %}"></script>
<script src="{% static 'js/dom.js' %}"></script>
<script src="{% static 'js/ui.js' %}"></script>
<script src="{% static 'js/ws.js' %}"></script>
<script src="{% static 'js/message.js' %}"></script>
<script src="{% static 'js/call.js' %}"></script>
<script src="{% static 'js/init.js' %}"></script>

{% endblock %}
