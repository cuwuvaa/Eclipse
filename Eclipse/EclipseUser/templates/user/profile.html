{% extends 'main/base.html' %}
{% load static %}

{% block title %}ECLIPSE - {{ USER.username }}'s Profile{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %}

{% block content %}
<div class="profile-container">
  <div class="avatar-section">
    <img src="{{ USER.avatar.url }}" alt="{{ USER.username }}'s avatar" class="profile-avatar">
  </div>

  <div class="info-section">
    <h1 class="profile-username">{{ USER.username }}:{{ USER.id }}</h1>
    <p class="profile-displayname">{{ USER.displayname }}</p>
  </div>

  {% if USER.username == user.username %}
  <div class="actions-section">
    <button id="edit-profile-btn" class="profile-btn">Edit Profile</button>
    <a href="{% url 'users:logout' %}" class="profile-btn logout-btn">Logout</a>
  </div>

  <div id="edit-profile-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h2>Edit Profile</h2>
      <form method="post" action="{% url 'users:profile' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
          <label for="id_displayname" class="form-label">Display Name</label>
          <input type="text" name="displayname" class="form-input" value="{{ user.displayname }}">
        </div>
        <div class="form-group">
          <label for="id_avatar" class="form-label">Avatar</label>
          <input type="file" name="avatar" class="form-input" accept="image/*">
        </div>
        <button type="submit" class="submit-btn">Save Changes</button>
      </form>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('edit-profile-modal');
  const btn = document.getElementById('edit-profile-btn');
  const span = modal.querySelector('.close-btn');

  if(btn) {
    btn.onclick = () => {
      modal.style.display = 'block';
    };
  }

  if(span) {
    span.onclick = () => {
      modal.style.display = 'none';
    };
  }

  window.onclick = (event) => {
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  };
});
</script>
{% endblock %}