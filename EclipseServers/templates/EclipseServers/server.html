{% extends 'EclipseServers/base/index.html' %}
{% load static %}

{% block title %}{{ server.name }}{% endblock %}
{% block link %} <link rel="stylesheet" href="{% static 'EclipseServers/css/current_server.css' %}"> {% endblock link %}

{% block content %}
<div class="server-container">
    <div class="server-layout">
        <div class="users-panel">
            <div class="panel-header">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <span class="member-count" id="member-count">0</span>
            </div>
            <div id="user_list" class="users-list">
            </div>
        </div>

        <div class="main-content">
            <header class="server-header">
                <div class="server-info">
                    <h1>{{ server.name }}</h1>
                    <span class="server-status">Todo: –û–Ω–ª–∞–π–Ω</span>
                </div>
                <div class="connection-controls">
                    <button id="connect_audio" class="btn btn-connect">
                        <span>üîä</span>
                        –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –∫–∞–Ω–∞–ª—É
                    </button>
                    <button id="disconnect_audio" class="btn btn-disconnect" disabled>
                        <span>üîá</span>
                        –ü–æ–∫–∏–Ω—É—Ç—å –∫–∞–Ω–∞–ª
                    </button>
                </div>
            </header>

            <div id="connected_audio" class="voice-chat-container">
                <div class="voice-placeholder">
                    <div class="voice-icon">üéôÔ∏è</div>
                    <p>–ì–æ–ª–æ—Å–æ–≤–æ–π –∫–∞–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω</p>
                    <span>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–≥–æ–≤–æ—Ä—É</span>
                </div>
            </div>

            <div class="chat-container" id="chat-container">
                <div class="chat-header" id="chat-header">
                    <div class="chat-info">
                        <span class="hashtag">#</span>
                        <h2>–û–±—â–∏–π —á–∞—Ç</h2>
                    </div>
                </div>

                <div class="messages-list" id="messages-list">
                    {% for message in server_messages %}
                    <div class="message-wrapper">
                        <div class="message-avatar-section">
                            <div class="message-avatar-container">
                                <img src="{{ message.sender.user.avatar.url }}" class="message-avatar" alt="–ê–≤–∞—Ç–∞—Ä" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiM3Mjg5ZGEiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDExQzE0LjIwOTEgMTEgMTYgOS4yMDkxIDE2IDdDMTYgNC43OTA4NiAxNC4yMDkxIDMgMTIgM0M5Ljc5MDg2IDMgOCA0Ljc5MDg2IDggN0M4IDkuMjA5MTQgOS43OTA4NiAxMSAxMiAxMVoiIGZpbGw9IiNGRkYiLz4KPHBhdGggZD0iTTEyIDEzQzguMTMgMTMgNSAxNi4xMyA1IDIwQzUgMjAuNTUyMyA1LjQ0NzcyIDIxIDYgMjFIMThDMTguNTUyMyAyMSAxOSAyMC41NTIzIDE5IDIwQzE5IDE2LjEzIDE1Ljg3IDEzIDEyIDEzWiIgZmlsbD0iI0ZGRiIvPgo8L3N2Zz4KPC9zdmc+'">
                            </div>
                        </div>
                        <div class="message-content-section">
                            <div class="message-header">
                                <span class="message-username">{{ message.sender.user.username }}</span>
                                <span class="message-timestamp">{{ message.timestamp }}</span>
                            </div>
                            <div class="message-text">
                                {{ message.content }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="message-input-container" id="message-input-container">
                    <div class="input-wrapper">
                        <img src="{{ user.avatar.url }}" class="message-input-avatar" id="current-user-avatar" alt="–ú–æ–π –∞–≤–∞—Ç–∞—Ä" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iMTYiIGZpbGw9IiM3Mjg5ZGEiLz4KPC9zdmc+'">             
                        <textarea class="message-input-field" id="message-input-field" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ #–æ–±—â–∏–π-—á–∞—Ç..." rows="1"></textarea>
                    </div>
                    <button class="message-send-button" id="message-send-button">
                        <span>‚û§</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const serverId = {{ server.id }};
    const myuserId = {{ user.id }};
    const myUsername = "{{ user.username }}";
    const myAvatar = "{{ user.avatar.url }}";
</script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="{% static 'js/audiowave.js' %}"></script>
<script src="{% static 'js/messages.js'%}"></script>
<script src="{% static 'js/servercall.js'%}"></script>
{% endblock %}