# Документация по тестированию

Этот документ описывает, как запускать тесты для данного проекта, а также предоставляет краткое описание существующих тестов.

## Запуск тестов

Тесты могут быть запущены как непосредственно в окружении Python, так и внутри Docker-контейнера.

### Запуск тестов в Docker

Для запуска тестов внутри Docker-контейнера выполните следующие шаги:

1.  Убедитесь, что ваш Docker-контейнер для бэкенда запущен. Имя контейнера для бэкенда обычно `eclipse-web-1` (вы можете проверить это с помощью `docker ps`).
2.  Сначала установите пакет `coverage` внутри контейнера, если он еще не установлен:
    ```bash
    docker exec eclipse-web-1 pip install coverage
    ```
3.  Запустите все тесты и сгенерируйте отчет о покрытии кода:
    ```bash
    docker exec eclipse-web-1 coverage run manage.py test --pattern="test_*.py" && docker exec eclipse-web-1 coverage report
    ```
    Эта команда выполнит все файлы тестов, имена которых начинаются с `test_*.py`, используя `coverage` для сбора данных о покрытии, а затем выведет сводный отчет о покрытии в консоль.

### Запуск тестов в Python (локально)

Для запуска тестов непосредственно в вашем локальном окружении Python выполните следующие шаги:

1.  Активируйте ваше виртуальное окружение:
    ```bash
    source venv/bin/activate
    ```
2.  Установите все необходимые зависимости, включая `coverage`:
    ```bash
    pip install -r Eclipse/requirements.txt
    pip install coverage
    ```
3.  Запустите все тесты и сгенерируйте отчет о покрытии кода:
    ```bash
    coverage run Eclipse/manage.py test --pattern="test_*.py" && coverage report
    ```
    Эта команда выполнит все файлы тестов, имена которых начинаются с `test_*.py`, используя `coverage` для сбора данных о покрытии, а затем выведет сводный отчет о покрытии в консоль.

## Обзор тестов

Проект содержит тесты для следующих компонентов бэкенда:

### `EclipseUser` App (Приложение пользователей)

*   **`tests/test_models.py`**:
    *   `EclipseUserModelTest`: Проверяет модель `EclipseUser`, включая автоматическое присвоение `displayname` из `username` и назначение аватара по умолчанию при создании пользователя. Также тестирует `CustomUserManager` для корректного создания обычных пользователей и суперпользователей.
*   **`tests/test_views.py`**:
    *   `ProfileViewTest`: Тестирует представление `Profile`, проверяя перенаправление на страницу текущего пользователя и корректное отображение профилей других пользователей.
    *   `MyProfileViewTest`: Тестирует представление `MyProfile`, включая отображение собственного профиля, обновление `displayname` и загрузку аватара.
*   **`tests/test_auth_views.py`**:
    *   `RegisterViewTest`: Тестирует представление `RegisterView` для регистрации новых пользователей, включая GET-запрос (отображение формы), POST-запрос с валидными данными (успешная регистрация и вход), POST-запрос с невалидными данными (например, несовпадающие пароли), попытку регистрации с существующим именем пользователя и перенаправление для уже аутентифицированных пользователей.
    *   `LoginViewTest`: Тестирует представление `LoginView` для входа пользователей, включая GET-запрос (отображение формы), POST-запрос с валидными данными (успешный вход), POST-запрос с невалидными данными (неверный пароль) и перенаправление для уже аутентифицированных пользователей.
    *   `LogoutViewTest`: Тестирует представление `LogoutView` для выхода пользователей, проверяя, что пользователь успешно выходит из системы.

### `EclipseRoom` App (Приложение комнат)

*   **`tests/test_models.py`**:
    *   `RoomModelTest`: Проверяет модель `Room`, включая назначение аватара по умолчанию при создании комнаты.
    *   `RoomUserModelTest`: Тестирует модель `RoomUser`, проверяя корректное создание пользователя комнаты.
    *   `RoomMessageModelTest`: Тестирует модель `RoomMessage`, проверяя корректное создание сообщения комнаты.
*   **`tests/test_views.py`**:
    *   `MainViewTest`: Тестирует представление `Main`, проверяя отображение списка комнат без запроса и с поисковым запросом.
    *   `RoomCreateViewTest`: Тестирует представление `RoomCreate`, включая отображение формы, создание комнаты с валидными и невалидными данными.
    *   `RoomPageViewTest`: Тестирует представление `RoomPage`, проверяя отображение страницы комнаты для участников и перенаправление для не-участников.
    *   `RoomJoinViewTest`: Тестирует представление `RoomJoin`, включая отображение формы для присоединения и успешное присоединение к комнате.
    *   `MyRoomsViewTest`: Тестирует представление `MyRooms`, проверяя отображение списка комнат, в которых состоит текущий пользователь.

### `api` App (API Приложение)

*   **`tests/test_views.py`**:
    *   `RoomsAPITest`: Тестирует `RoomsAPI` для получения списка всех комнат.
    *   `RoomUsersAPITest`: Тестирует `RoomUsersAPI` для получения списка пользователей в определенной комнате.
    *   `RoomMessageAPITest`: Тестирует `RoomMessageAPI` для получения сообщений в определенной комнате.
    *   `RoomUpdateViewTest`: Тестирует `RoomUpdateView` для обновления информации о комнате (описание, аватар), проверяя разрешения для создателей, модераторов и обычных пользователей.
    *   `RoomDeleteViewTest`: Тестирует `RoomDeleteView` для удаления комнаты, проверяя разрешения для создателей, корректность фразы-пароля и обработку несуществующих комнат.
    *   `RoomMessageDeleteViewTest`: Тестирует `RoomMessageDeleteView` для удаления сообщений.
    *   `RoomUserAPITest`: Тестирует `RoomUserAPI` для получения информации о конкретном пользователе комнаты.
    *   `RoomUserDeleteViewTest`: Тестирует `RoomUserDeleteView` для удаления пользователя из комнаты.
    *   `RoomUserRoleUpdateViewTest`: Тестирует `RoomUserRoleUpdateView` для изменения роли пользователя в комнате.
    *   `RoomBulkUsersAPITest`: Тестирует `RoomBulkUsersAPI` для получения информации о нескольких пользователях комнаты.
*   **`tests/test_permissions.py`**:
    *   `PermissionTest`: Тестирует `IsRoomAdminOrCreator` для `RoomMessage` и `Room` объектов, проверяя разрешения для создателей, модераторов, отправителей сообщений и других пользователей.
    *   `IsRoomCreatorTest`: Тестирует `IsRoomCreator` для проверки разрешений на удаление комнаты.
    *   `IsModeratorTest`: Тестирует `IsModerator` для проверки разрешений на модерацию.
    *   `RoleChangeTest`: Тестирует `RoleChange` для проверки разрешений на изменение ролей пользователей.
    *   `IsRoomMemberTest`: Тестирует `IsRoomMember` для проверки разрешений на доступ к ресурсам комнаты для участников и неавторизованных пользователей.
